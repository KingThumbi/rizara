{# /home/thumbi/rizara/app/templates/processing/list.html #}
{% extends "layouts/base.html" %}

{% block title %}Processing Batches | Rizara{% endblock %}

{% block head %}
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            jungle: '#1f6f54',
            jungleLight: '#2f8f6b',
            gold: '#d4af37',
            grayDark: '#1f2937'
          }
        }
      }
    }
  </script>
{% endblock %}

{% block body %}

  <!-- Navbar -->
  <nav class="bg-jungle text-white px-6 py-4 flex justify-between items-center shadow">
    <div class="text-xl font-bold tracking-wide">Rizara Meats</div>
    <div class="flex items-center gap-3">
      <a href="{{ url_for('main.dashboard') }}"
         class="bg-gold text-jungle font-semibold px-4 py-2 rounded hover:bg-yellow-400 transition">
        ← Back to Dashboard
      </a>
      <a href="{{ url_for('auth.logout') }}"
         class="bg-white/10 text-white font-semibold px-4 py-2 rounded hover:bg-white/20 transition">
        Logout
      </a>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-6 py-10">

    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-jungle">Processing Batches</h1>
      <p class="text-gray-600 mt-1">
        Livestock batches currently in processing.
      </p>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-3">
          {% for category, message in messages %}
            <div class="px-4 py-3 rounded-lg
              {% if category == 'success' %}
                bg-green-100 text-green-800
              {% elif category in ['danger', 'error'] %}
                bg-red-100 text-red-800
              {% else %}
                bg-gray-100 text-gray-800
              {% endif %}
            ">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Content -->
    <div class="bg-white rounded-xl shadow overflow-hidden">

      <div class="px-6 py-4 border-b border-gray-100 text-sm text-gray-600">
        {% if batches %}
          Showing <b>{{ batches|length }}</b> processing batch{{ '' if batches|length == 1 else 'es' }}.
        {% else %}
          No processing batches yet.
        {% endif %}
      </div>

      {% if not batches %}
        <div class="p-6">
          <div class="bg-gray-50 border border-gray-200 text-gray-700 px-4 py-3 rounded-lg">
            No processing batches found.
          </div>
        </div>
      {% else %}
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead class="bg-gray-50 sticky top-0">
              <tr class="text-left text-gray-700">
                <th class="p-4">Batch ID</th>
                <th class="p-4">Animal Type</th>
                <th class="p-4">Facility</th>
                <th class="p-4">Slaughter Date</th>
                <th class="p-4">Animals</th>
                <th class="p-4">Status</th>
                <th class="p-4">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for batch in batches %}
                <tr class="border-t hover:bg-gray-50">
                  <td class="p-4 font-semibold text-gray-900">
                    #{{ batch.id }}
                  </td>

                  <td class="p-4 text-gray-700">
                    {{ batch.animal_type|capitalize }}
                  </td>

                  <td class="p-4 text-gray-700">
                    {{ batch.facility }}
                  </td>

                  <td class="p-4 text-gray-700">
                    {{ batch.slaughter_date if batch.slaughter_date else '-' }}
                  </td>

                  <td class="p-4 text-gray-700">
                    {% if batch.animal_type == 'goat' %}
                      {{ batch.goats|length }} goats
                    {% elif batch.animal_type == 'sheep' %}
                      {{ batch.sheep|length }} sheep
                    {% elif batch.animal_type == 'cattle' %}
                      {{ batch.cattle|length }} cattle
                    {% else %}
                      —
                    {% endif %}
                  </td>

                  <td class="p-4">
                    {% if batch.is_locked %}
                      <span class="px-3 py-1 rounded-full bg-gray-200 text-gray-800 text-xs font-semibold">
                        Locked
                      </span>
                    {% else %}
                      <span class="px-3 py-1 rounded-full bg-green-100 text-green-800 text-xs font-semibold">
                        Open
                      </span>
                    {% endif %}
                  </td>

                  <td class="p-4">
                    <a href="{{ url_for('main.processing_batch_detail', batch_id=batch.id) }}"
                       class="px-4 py-2 rounded-lg bg-jungle text-white text-sm font-semibold hover:bg-jungleLight transition">
                      View
                    </a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>

  </main>

  <footer class="text-center text-sm text-gray-500 py-6">
    © {{ current_year or 2026 }} Rizara Meats Ltd — Secure • Traceable • Halal
  </footer>

{% endblock %}
