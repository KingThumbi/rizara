<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rizara Dashboard</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        jungle: '#1f6f54',
                        gold: '#d4af37',
                        jungleLight: '#2f8f6b',
                        grayDark: '#1f2937'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-100 min-h-screen">

<!-- NAVBAR -->
<nav class="bg-jungle text-white px-6 py-4 flex justify-between items-center shadow">
    <div class="text-2xl font-bold tracking-wide">Rizara Meats</div>
    <div class="flex items-center gap-6">
        <span class="text-sm opacity-90">Operations Dashboard</span>
        <a href="{{ url_for('auth.logout') }}"
           class="bg-gold text-jungle font-semibold px-4 py-2 rounded hover:bg-yellow-400 transition">
            Logout
        </a>
    </div>
</nav>

<!-- MAIN -->
<main class="max-w-7xl mx-auto px-6 py-8">

    <!-- PAGE TITLE -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-jungle">Operations Dashboard</h1>
        <p class="text-gray-600 mt-1">
            Livestock aggregation & processing overview
        </p>
    </div>

    <!-- KPI CARDS -->
    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">

        <div class="bg-white rounded-xl shadow p-6 border-l-8 border-jungle">
            <h3 class="text-gray-500 text-sm uppercase">Farmers</h3>
            <p class="text-3xl font-bold text-jungle mt-2">{{ stats.farmers or 0 }}</p>
        </div>

        <div class="bg-white rounded-xl shadow p-6 border-l-8 border-gold">
            <h3 class="text-gray-500 text-sm uppercase">Goats Tracked</h3>
            <p class="text-3xl font-bold text-jungle mt-2">{{ stats.goats or 0 }}</p>
        </div>

        <div class="bg-white rounded-xl shadow p-6 border-l-8 border-jungleLight">
            <h3 class="text-gray-500 text-sm uppercase">Aggregation Batches</h3>
            <p class="text-3xl font-bold text-jungle mt-2">
                {{ stats.aggregation_batches or 0 }}
            </p>
        </div>

        <div class="bg-white rounded-xl shadow p-6 border-l-8 border-gray-400">
            <h3 class="text-gray-500 text-sm uppercase">Processing Batches</h3>
            <p class="text-3xl font-bold text-jungle mt-2">
                {{ stats.processing_batches or 0 }}
            </p>
        </div>

    </section>

    <!-- QUICK ACTIONS -->
    <section class="bg-white rounded-xl shadow p-6 mb-10">
        <h2 class="text-xl font-semibold text-jungle mb-4">Quick Actions</h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

            <a href="{{ url_for('main.add_farmer') }}"
               class="flex justify-center items-center bg-jungle text-white py-4 rounded-lg font-semibold hover:bg-jungleLight transition">
                + Add Farmer
            </a>

            <a href="{{ url_for('main.add_goat') }}"
               class="flex justify-center items-center bg-gold text-jungle py-4 rounded-lg font-semibold hover:bg-yellow-400 transition">
                + Register Goat
            </a>

            <a href="{{ url_for('main.add_aggregation_batch') }}"
               class="flex justify-center items-center bg-gray-800 text-white py-4 rounded-lg font-semibold hover:bg-grayDark transition">
                + Create Aggregation Batch
            </a>

            <!-- RESTORED -->
            <a href="{{ url_for('main.add_processing_batch') }}"
               class="flex justify-center items-center bg-gray-700 text-white py-4 rounded-lg font-semibold hover:bg-gray-600 transition">
                + Process Batch
            </a>

        </div>
    </section>

    <!-- ADMIN SECTIONS -->
    <section class="bg-white rounded-xl shadow p-6 mb-10">
        <h2 class="text-xl font-semibold text-jungle mb-4">Admin Sections</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <a href="{{ url_for('main.contact_messages') }}"
               class="flex justify-center items-center bg-blue-600 text-white py-4 rounded-lg font-semibold hover:bg-blue-500 transition">
                Contact Messages
            </a>

            <a href="{{ url_for('main.order_requests') }}"
               class="flex justify-center items-center bg-green-600 text-white py-4 rounded-lg font-semibold hover:bg-green-500 transition">
                Order Requests
            </a>

        </div>
    </section>

    <!-- GOAT STATUS PIPELINE -->
    <section class="bg-white rounded-xl shadow p-6 mb-10">
        <h2 class="text-xl font-semibold text-jungle mb-4">Goat Status Pipeline</h2>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

            <div class="bg-green-100 rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600 uppercase">On Farm</h3>
                <p class="text-2xl font-bold text-green-700">
                    {{ stats.goats_on_farm or 0 }}
                </p>
            </div>

            <div class="bg-blue-100 rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600 uppercase">Aggregated</h3>
                <p class="text-2xl font-bold text-blue-700">
                    {{ stats.goats_aggregated or 0 }}
                </p>
            </div>

            <div class="bg-yellow-100 rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600 uppercase">Processed</h3>
                <p class="text-2xl font-bold text-yellow-700">
                    {{ stats.goats_processed or 0 }}
                </p>
            </div>

            <div class="bg-red-100 rounded-lg p-4 text-center">
                <h3 class="text-sm text-gray-600 uppercase">Sold</h3>
                <p class="text-2xl font-bold text-red-700">
                    {{ stats.goats_sold or 0 }}
                </p>
            </div>

        </div>
    </section>

    <!-- RECENT CONTACTS & ORDERS -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10">

        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold text-jungle mb-3">
                Recent Contact Messages
            </h2>

            {% if stats.latest_contacts %}
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b">
                        <th class="py-2 text-left">Name</th>
                        <th>Email</th>
                        <th>Received</th>
                    </tr>
                </thead>
                <tbody>
                    {% for msg in stats.latest_contacts %}
                    <tr class="border-b hover:bg-gray-50">
                        <td>{{ msg.name }}</td>
                        <td>{{ msg.email }}</td>
                        <td>{{ msg.created_at.strftime('%Y-%m-%d') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-gray-500 text-sm">No contact messages yet.</p>
            {% endif %}
        </div>

        <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-lg font-semibold text-jungle mb-3">
                Recent Order Requests
            </h2>

            {% if stats.latest_orders %}
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b">
                        <th class="py-2 text-left">Buyer</th>
                        <th>Product</th>
                        <th>Qty (kg)</th>
                        <th>Received</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in stats.latest_orders %}
                    <tr class="border-b hover:bg-gray-50">
                        <td>{{ order.buyer_name }}</td>
                        <td>{{ order.product }}</td>
                        <td>{{ order.quantity }}</td>
                        <td>{{ order.created_at.strftime('%Y-%m-%d') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="text-gray-500 text-sm">No order requests yet.</p>
            {% endif %}
        </div>

    </section>

</main>

<!-- FOOTER -->
<footer class="text-center text-sm text-gray-500 py-6">
    © {{ current_year or 2026 }} Rizara Meats Ltd — Ethical • Traceable • Halal
</footer>

</body>
</html>
