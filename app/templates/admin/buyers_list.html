{% extends "layouts/base_admin.html" %}

{% block page_title %}Buyers{% endblock %}

{% block content %}
  <div class="flex items-start justify-between gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Buyers</h1>
      <p class="text-sm text-gray-600 mt-1">
        Customer profiles used for documents, invoices, orders, and sales.
      </p>
    </div>

    <div class="flex items-center gap-2">
      <a
        href="{{ url_for('admin.buyers_new') }}"
        class="inline-flex items-center rounded-lg bg-jungle px-4 py-2 text-white font-semibold hover:bg-jungleLight transition"
      >
        + New Buyer
      </a>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
    <form method="GET" class="flex flex-col md:flex-row md:items-center gap-3">
      <div class="flex-1">
        <label class="block text-xs font-semibold text-gray-600 mb-1">Search</label>
        <input
          type="text"
          name="q"
          value="{{ q or '' }}"
          placeholder="Search name, email, phone, tax PIN..."
          class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-jungle/40"
        />
      </div>

      <div class="flex items-end gap-2">
        <button
          type="submit"
          class="inline-flex items-center rounded-lg bg-gray-900 px-4 py-2 text-white font-semibold hover:bg-black transition"
        >
          Search
        </button>

        {% if q %}
          <a
            href="{{ url_for('admin.buyers_list') }}"
            class="inline-flex items-center rounded-lg border border-gray-300 px-4 py-2 font-semibold text-gray-700 hover:bg-gray-50 transition"
          >
            Reset
          </a>
        {% endif %}
      </div>
    </form>
  </div>

  <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
            <th class="px-4 py-3">Buyer</th>
            <th class="px-4 py-3">Contact</th>
            <th class="px-4 py-3">Tax PIN</th>
            <th class="px-4 py-3">Created</th>
          </tr>
        </thead>

        <tbody class="divide-y divide-gray-100">
          {% if buyers and buyers|length > 0 %}
            {% for b in buyers %}
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3">
                  <div class="font-semibold text-gray-900">{{ b.name }}</div>
                  <div class="text-sm text-gray-600">
                    ID: {{ b.id }}
                    {% if b.user_id %}
                      <span class="ml-2 inline-flex items-center rounded-full bg-jungle/10 text-jungle px-2 py-0.5 text-xs font-semibold">
                        login enabled
                      </span>
                    {% else %}
                      <span class="ml-2 inline-flex items-center rounded-full bg-gray-100 text-gray-700 px-2 py-0.5 text-xs font-semibold">
                        no login
                      </span>
                    {% endif %}
                  </div>
                </td>

                <td class="px-4 py-3">
                  <div class="text-sm text-gray-900">
                    {% if b.email %}
                      <div class="truncate max-w-[360px]">{{ b.email }}</div>
                    {% else %}
                      <div class="text-gray-400">—</div>
                    {% endif %}
                  </div>
                  <div class="text-sm text-gray-600">
                    {% if b.phone %}
                      {{ b.phone }}
                    {% else %}
                      <span class="text-gray-400">—</span>
                    {% endif %}
                  </div>
                </td>

                <td class="px-4 py-3 text-sm text-gray-900">
                  {% if b.tax_pin %}
                    {{ b.tax_pin }}
                  {% else %}
                    <span class="text-gray-400">—</span>
                  {% endif %}
                </td>

                <td class="px-4 py-3 text-sm text-gray-700">
                  {% if b.created_at %}
                    {{ b.created_at }}
                  {% else %}
                    <span class="text-gray-400">—</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" class="px-4 py-10 text-center text-gray-600">
                <div class="font-semibold">No buyers found</div>
                <div class="text-sm mt-1">Create a buyer to assign documents, invoices, and orders.</div>
                <a
                  href="{{ url_for('admin.buyers_new') }}"
                  class="mt-4 inline-flex items-center rounded-lg bg-jungle px-4 py-2 text-white font-semibold hover:bg-jungleLight transition"
                >
                  + New Buyer
                </a>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
