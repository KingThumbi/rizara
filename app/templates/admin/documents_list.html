{% extends "layouts/base_admin.html" %}
{% block page_title %}Documents · Rizara Admin{% endblock %}

{% block content %}
  <div class="flex items-start justify-between gap-4 mb-6">
    <div>
      <h1 class="text-3xl font-bold text-jungle">Documents</h1>
      <p class="text-gray-600 mt-1">Create, review, and track buyer documents and signature status.</p>
    </div>

    <a href="{{ url_for('admin.documents_new') }}"
       class="bg-gold text-jungle font-semibold px-4 py-2 rounded hover:bg-yellow-400 transition">
      + New Document
    </a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-6 space-y-3">
        {% for category, message in messages %}
          <div class="px-4 py-3 rounded-lg
            {% if category == 'success' %}
              bg-green-100 text-green-800
            {% elif category in ['danger', 'error'] %}
              bg-red-100 text-red-800
            {% elif category == 'warning' %}
              bg-yellow-100 text-yellow-800
            {% else %}
              bg-gray-100 text-gray-800
            {% endif %}
          ">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="GET" class="bg-white rounded-xl shadow p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold text-gray-700 mb-1">Search</label>
        <input name="q" value="{{ q or '' }}" placeholder="Buyer name / email / document id…"
               class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-jungle/30" />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">Doc type</label>
        <input name="doc_type" value="{{ doc_type or '' }}" placeholder="e.g. contract"
               class="w-full border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-jungle/30" />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">Status</label>
        <select name="status"
                class="w-full border border-gray-200 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-jungle/30">
          <option value="" {% if not status %}selected{% endif %}>All</option>
          {% for s in (doc_statuses or []) %}
            <option value="{{ s }}" {% if status == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="flex gap-3 justify-end mt-4">
      <button type="submit"
              class="bg-jungle text-white font-semibold px-4 py-2 rounded hover:bg-jungleLight transition">
        Filter
      </button>
      <a href="{{ url_for('admin.documents_list') }}"
         class="bg-white border border-gray-200 text-gray-800 font-semibold px-4 py-2 rounded hover:bg-gray-50 transition">
        Reset
      </a>
    </div>
  </form>

  <div class="bg-white rounded-xl shadow overflow-hidden">
    <div class="overflow-auto">
      <table class="w-full text-sm">
        <thead class="bg-gray-50 border-b">
          <tr>
            <th class="text-left px-4 py-3 font-semibold text-gray-700">Document</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700">Buyer</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700">Type</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700">Status</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700">Version</th>
            <th class="text-left px-4 py-3 font-semibold text-gray-700">Updated</th>
            <th class="text-right px-4 py-3 font-semibold text-gray-700">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if documents %}
            {% for d in documents %}
              <tr class="border-b hover:bg-gray-50">
                <td class="px-4 py-3 align-top">
                  <div class="font-semibold text-jungle">
                    <a href="{{ url_for('admin.documents_view', document_id=d.id) }}" class="hover:underline">
                      {{ d.id }}
                    </a>
                  </div>
                  <div class="text-gray-500 text-xs mt-1">{{ d.title }}</div>
                </td>

                <td class="px-4 py-3 align-top">
                  <div class="font-semibold text-gray-900">{{ d.buyer.name if d.buyer else '—' }}</div>
                  <div class="text-gray-500 text-xs mt-1">{{ d.buyer.email if d.buyer else '' }}</div>
                </td>

                <td class="px-4 py-3 align-top text-gray-800">{{ d.doc_type or '—' }}</td>

                <td class="px-4 py-3 align-top">
                  <span class="inline-flex px-3 py-1 rounded-full border border-gray-200 text-xs font-semibold">
                    {{ d.status or '—' }}
                  </span>
                </td>

                <td class="px-4 py-3 align-top text-gray-800">{{ d.version or 1 }}</td>
                <td class="px-4 py-3 align-top text-gray-700">{{ d.updated_at or d.created_at or '' }}</td>

                <td class="px-4 py-3 align-top text-right">
                  <a href="{{ url_for('admin.documents_view', document_id=d.id) }}"
                     class="inline-flex border border-gray-200 bg-white px-3 py-2 rounded font-semibold hover:bg-gray-50 transition">
                    View
                  </a>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="7" class="px-4 py-6 text-gray-500">No documents found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
