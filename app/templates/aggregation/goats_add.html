{# app/templates/aggregation/goats_add.html #}
{% extends "layouts/base.html" %}

{% block title %}Create Goat Aggregation Batch | Rizara{% endblock %}

{% block head %}
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            jungle: '#1f6f54',
            jungleLight: '#2f8f6b',
            gold: '#d4af37',
            grayDark: '#1f2937'
          }
        }
      }
    }
  </script>
{% endblock %}

{% block body %}

  <nav class="bg-jungle text-white px-6 py-4 flex justify-between items-center shadow">
    <div class="text-xl font-bold tracking-wide">Rizara Meats</div>
    <div class="flex items-center gap-3">
      <a href="{{ url_for('main.dashboard') }}"
         class="bg-gold text-jungle font-semibold px-4 py-2 rounded hover:bg-yellow-400 transition">
        ← Back to Dashboard
      </a>
      <a href="{{ url_for('auth.logout') }}"
         class="bg-white/10 text-white font-semibold px-4 py-2 rounded hover:bg-white/20 transition">
        Logout
      </a>
    </div>
  </nav>

  <main class="max-w-5xl mx-auto px-6 py-10">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-jungle">Create Goat Aggregation Batch</h1>
      <p class="text-gray-600 mt-1">Move goats from <b>On Farm</b> to <b>Aggregated</b>.</p>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-6 space-y-3">
          {% for category, message in messages %}
            <div class="px-4 py-3 rounded-lg
              {% if category == 'success' %}
                bg-green-100 text-green-800
              {% elif category == 'danger' or category == 'error' %}
                bg-red-100 text-red-800
              {% else %}
                bg-gray-100 text-gray-800
              {% endif %}
            ">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="bg-white rounded-xl shadow p-8">
      <form method="POST" class="space-y-6">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Aggregation Site Name</label>
            <input type="text" name="site_name" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-jungle" />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">
              Date Received <span class="text-gray-400">(optional)</span>
            </label>
            <input type="date" name="date_received" value="{{ date.today().isoformat() }}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-jungle" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Select Goats (On Farm)</label>

          {% if not animals %}
            <div class="bg-gray-100 text-gray-700 px-4 py-3 rounded-lg">
              No goats available in <b>On Farm</b> status.
            </div>
          {% else %}
            <div class="border border-gray-200 rounded-lg overflow-hidden">
              <div class="max-h-[26rem] overflow-auto">
                <table class="w-full text-sm">
                  <thead class="bg-gray-50 sticky top-0">
                    <tr class="text-left">
                      <th class="p-3 w-12">Pick</th>
                      <th class="p-3">Rizara ID</th>
                      <th class="p-3">Farmer</th>
                      <th class="p-3">Sex</th>
                      <th class="p-3">Breed</th>
                      <th class="p-3 w-36">Live Weight (kg)</th>
                      <th class="p-3 w-40">Price / Head (KES)</th>
                      <th class="p-3 w-40">Weight Method</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for a in animals %}
                      <tr class="border-t hover:bg-gray-50 align-top">
                        <td class="p-3">
                          <input type="checkbox" name="animal_ids" value="{{ a.id }}"
                                 class="h-4 w-4 accent-jungle" />
                        </td>
                        <td class="p-3 font-medium text-gray-900">{{ a.rizara_id }}</td>
                        <td class="p-3 text-gray-700">{{ a.farmer_tag }}</td>
                        <td class="p-3 text-gray-700">{{ a.sex or "-" }}</td>
                        <td class="p-3 text-gray-700">{{ a.breed or "-" }}</td>

                        <td class="p-3">
                          <input type="number" step="0.1" min="0"
                                 name="weight_{{ a.id }}"
                                 placeholder="e.g. 32.5"
                                 class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-jungle" />
                        </td>

                        <td class="p-3">
                          <input type="number" step="0.01" min="0"
                                 name="price_{{ a.id }}"
                                 placeholder="e.g. 6500"
                                 class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-jungle" />
                        </td>

                        <td class="p-3">
                          <select name="method_{{ a.id }}"
                                  class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-jungle">
                            <option value="scale" selected>Scale</option>
                            <option value="estimated">Estimated</option>
                            <option value="tape">Weight tape</option>
                            <option value="other">Other</option>
                          </select>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-2">
              Selected goats will be marked as <b>aggregated</b>. You can optionally record live weight + price per head during aggregation.
            </p>
          {% endif %}
        </div>

        <div class="flex justify-end gap-4 pt-2">
          <a href="{{ url_for('main.dashboard') }}"
             class="px-5 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-100 transition">
            Cancel
          </a>
          <button type="submit"
                  class="px-6 py-2 rounded-lg bg-jungle text-white font-semibold hover:bg-jungleLight transition">
            Create Batch
          </button>
        </div>

      </form>
    </div>
  </main>

  <footer class="text-center text-sm text-gray-500 py-6">
    © {{ current_year or 2026 }} Rizara Meats Ltd — Secure • Traceable • Halal
  </footer>

{% endblock %}
